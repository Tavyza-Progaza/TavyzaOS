local a={}local function b(c)if c:sub(-1)~="\n"then c=c.."\n"end;return c:gmatch("(.-)\n")end;local function d(e)local f=kernel.primary_gpu.getForeground()kernel.primary_gpu.setForeground(0xFF0000)for c in b(e)do io.println(c)end;kernel.primary_gpu.setForeground(f)end;local function g(h)words={}for i in h:gmatch("%S+")do table.insert(words,i)end;h=words[1]table.remove(words,1)if h==""then d("Must specify file name")return end;if not h:match("%.lua$")then h="/cmd/"..h..".lua"end;if fs.exists(h)then os.log("Attempting to run file at "..h)xpcall(require(h),function(e)d(e)d(debug.traceback())end,table.unpack(words))else d("File '"..h.."' does not exist")end end;local function j()local f=kernel.primary_gpu.getForeground()kernel.primary_gpu.setForeground(0x00FF00)io.print("$ ")kernel.primary_gpu.setForeground(f)end;local function k()io.clear()local l=""j()while true do local m=keyboard.getNextKey()if m=="BACK"then if l~=""then l=l:sub(1,-2)io.erase(1)end elseif m=="ENTER"then io.println("")g(l)l=""j()else io.print(m)l=l..m end end end;function a.getShell()return thread.create(k,8)end;return a